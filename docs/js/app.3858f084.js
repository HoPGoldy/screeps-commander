(function(t){function e(e){for(var a,i,r=e[0],c=e[1],l=e[2],d=0,m=[];d<r.length;d++)i=r[d],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&m.push(s[i][0]),s[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(m.length)m.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],a=!0,r=1;r<n.length;r++){var c=n[r];0!==s[c]&&(a=!1)}a&&(o.splice(e--,1),t=i(i.s=n[0]))}return t}var a={},s={app:0},o=[];function i(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=a,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(n,a,function(e){return t[e]}.bind(null,a));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var l=0;l<r.length;l++)e(r[l]);var u=c;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},"18ea":function(t,e,n){"use strict";var a=n("8aab"),s=n.n(a);s.a},"23f9":function(t,e,n){"use strict";var a=n("8704"),s=n.n(a);s.a},7742:function(t,e,n){},8704:function(t,e,n){},"8aab":function(t,e,n){},a0d1:function(t,e,n){"use strict";var a=n("7742"),s=n.n(a);s.a},cd49:function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),s=n("bc3a"),o=n.n(s),i=n("4328"),r=n.n(i),c={screeps:"https://screeps.com"};o.a.interceptors.request.use((function(t){return t}));var l=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"screeps",s=/http/.test(t)?t:c[a]+t;return o()({url:s,params:e,method:"get",headers:n})},u=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"screeps";e=r.a.stringify(e);var s=/http/.test(t)?t:c[a]+t;return o()({url:s,data:e,method:"post",headers:n})},d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",[n("div",[n("v-app-bar",{attrs:{color:"blue accent-3",dark:"",app:""}},[n("v-app-bar-nav-icon",{on:{click:function(e){e.stopPropagation(),t.showSideDrawer=!t.showSideDrawer}}}),n("v-toolbar-title",[t._v("Screeps Commander")])],1)],1),n("v-navigation-drawer",{attrs:{app:"",temporary:""},model:{value:t.showSideDrawer,callback:function(e){t.showSideDrawer=e},expression:"showSideDrawer"}},[n("v-list-item",[n("v-list-item-content",[n("v-list-item-title",{staticClass:"title"},[t._v("Screeps Commander")]),n("v-list-item-subtitle",[t._v("@hopgoldy")])],1)],1),n("v-divider"),n("v-list",{attrs:{dense:"",nav:""}},t._l(t.items,(function(e){return n("v-list-item",{key:e.title,attrs:{link:""}},[n("v-list-item-icon",[n("v-icon",[t._v(t._s(e.icon))])],1),n("v-list-item-content",[n("v-list-item-title",[t._v(t._s(e.title))])],1)],1)})),1)],1),n("v-content",{attrs:{app:""}},[n("keep-alive",[n("router-view")],1)],1),n("Boot",{attrs:{show:t.showBoot},on:{"on-finish":t.onBootFinish}})],1)},m=[],p=n("d4ec"),v=n("bee2"),h=n("99de"),f=n("7e84"),b=n("262e"),g=n("9ab4"),w=n("60a3"),k="screepsCommandStorage",y=function(t){function e(){return Object(p["a"])(this,e),Object(h["a"])(this,Object(f["a"])(e).apply(this,arguments))}return Object(b["a"])(e,t),Object(v["a"])(e,[{key:"hasStorage",value:function(){var t=localStorage.getItem(k);return"string"===typeof t}},{key:"storage",get:function(){if(!this.dataBase){var t=localStorage.getItem(k);t?this.dataBase=JSON.parse(t):(this.dataBase={loginData:{email:"",password:""},commands:[]},localStorage.setItem(k,JSON.stringify(this.dataBase)))}return this.dataBase},set:function(t){this.dataBase=t,localStorage.setItem(k,JSON.stringify(t))}}]),e}(w["e"]);y=Object(g["a"])([w["a"]],y);var O=y,j=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-overlay",{attrs:{value:t.show}},[n("v-card",{staticClass:"mx-auto",attrs:{"max-width":"300",light:""}},[n("v-card-title",{staticClass:"title font-weight-regular justify-space-between pb-1"},[n("span",[t._v(t._s(t.currentTitle))])]),n("v-window",{model:{value:t.step,callback:function(e){t.step=e},expression:"step"}},[n("v-window-item",{attrs:{value:1}},[n("div",{staticClass:"pa-2 pt-0"},[n("v-list-item",{attrs:{"three-line":""}},[n("v-list-item-content",[n("v-list-item-title",[t._v("隐私")]),n("div",{staticClass:"content"},[t._v("本应用所有数据均保存在本地，自动或手动清除浏览器缓存将可能导致数据丢失，请妥善使用导出 / 导入功能。")])],1)],1),n("v-list-item",{attrs:{"two-line":""}},[n("v-list-item-content",[n("v-list-item-title",[t._v("开源")]),n("div",{staticClass:"content"},[t._v("本应用代码已开源至 github。")])],1)],1)],1)]),n("v-window-item",{attrs:{value:2}},[n("v-card-text",{staticClass:"pt-0"},[n("v-text-field",{attrs:{label:"Screeps 登陆邮箱","hide-details":""},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}}),n("v-text-field",{staticClass:"mt-2",attrs:{label:"Screeps 登陆密码","hide-details":"",type:"password"},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),n("div",{staticClass:"mt-5 caption grey--text text--darken-1"},[t._v("本应用不会上传您的任何个人信息，所有信息均保存在本地")])],1)],1),n("v-window-item",{attrs:{value:3}},[n("div",{staticClass:"pa-2 pt-0 text-center"},[n("v-list-item",[n("v-list-item-content",[n("div",{staticClass:"title mb-4"},[t._v("欢迎回来！")]),n("div",{staticClass:"subtitle-1"},[t._v("现在你可以直接与 Screeps 控制台进行交互，所有控制台输出也会直接反馈到本应用中。")]),n("div",{staticClass:"subtitle-1"},[t._v("同时你也可以自定义快捷命令来快速执行某些常用操作。点击左上角按钮来了解更多操作。")])])],1)],1)])],1),n("v-divider"),n("v-card-actions",[n("v-btn",{attrs:{disabled:1===t.step,text:""},on:{click:function(e){t.step--}}},[t._v("上一步")]),n("v-spacer"),n("v-btn",{attrs:{color:"primary",depressed:"",loading:t.confirmBtnLoading},on:{click:t.next}},[t._v("确认")])],1)],1),n("v-snackbar",{attrs:{color:t.messageColor},model:{value:t.showMessage,callback:function(e){t.showMessage=e},expression:"showMessage"}},[t._v(t._s(t.messageText)),n("v-btn",{attrs:{text:""},on:{click:function(e){t.showMessage=!1}}},[t._v("关闭")])],1)],1)},C=[],x=(n("99af"),n("caad"),n("d3b7"),n("ac1f"),n("2532"),n("3ca3"),n("1276"),n("ddb0"),n("3835")),S=function(t){function e(){return Object(p["a"])(this,e),Object(h["a"])(this,Object(f["a"])(e).apply(this,arguments))}return Object(b["a"])(e,t),Object(v["a"])(e,[{key:"initScreepsApi",value:function(t,e){var n=this,a=this.getSessionToken(t,e).then((function(t){return n.getPlayerInfo(t)})),s=this.initWebSocket();return Promise.all([a,s]).then((function(t){var e=Object(x["a"])(t,2),a=e[0],s=e[1];return n.playerInfo=a,n.authSessionToken(s,a.sessionToken)})).then((function(t){var e=t.ws,a=t.sessionToken;return console.log("准备就绪！",a,e),n.screepsWebSock=e,n.playerInfo.sessionToken=a,n.subscribeConsole(n.screepsWebSock,n.playerInfo.userId)}))}},{key:"initWebSocket",value:function(){var t=this;return new Promise((function(e,n){var a="wss://screeps.com/socket/".concat(t.getRandStr("number",3),"/").concat(t.getRandStr("string",8),"/websocket");console.log("TCL: ScreepsApi -> screepsUrl",a);var s=new WebSocket(a);s.onopen=function(){return e(s)},s.onerror=function(t){return n(t)}}))}},{key:"getPlayerInfo",value:function(t){return new Promise((function(e,n){l("/api/auth/me",{},{"X-token":t}).then((function(t){200===t.status&&1===t.data.ok?e({username:t.data.username,userId:t.data._id,money:t.data.money,sessionToken:t.config.headers["X-token"]}):n(t.status)}))}))}},{key:"sendConsoleExpression",value:function(t,e){this.playerInfo&&u("/api/user/console",{expression:t,shard:e},{"X-token":this.playerInfo.sessionToken}).then((function(t){console.log(t)}))}},{key:"authSessionToken",value:function(t,e){return new Promise((function(n,a){t.send('["auth '.concat(e,'"]')),t.onmessage=function(e){if("a"===e.data[0]){var s=JSON.parse(e.data.substring(1))[0];s.includes("auth ok")?n({ws:t,sessionToken:s.split(" ")[2]}):s.includes("auth failed")&&a(e)}}}))}},{key:"subscribeConsole",value:function(t,e){return new Promise((function(n){t.send('["subscribe user:'.concat(e,'/console"]')),console.log("已订阅控制台"),n(t)}))}},{key:"getSessionToken",value:function(t,e){return new Promise((function(n,a){u("/api/auth/signin",{email:t,password:e}).then((function(t){200===t.status&&1===t.data.ok?n(t.data.token):(console.log("123",t),a(t))})).catch((function(t){return a(t)}))}))}},{key:"getRandStr",value:function(t,e){for(var n="number"===t?"0123456789":"abcdefghijklmnopqrstuvwxyz",a="",s=0;s<e;s++)a+=n.charAt(Math.floor(Math.random()*n.length));return a}},{key:"getDataInMessage",value:function(t){return"a"===t[0]||"m"===t[0]?JSON.parse(t.substr(1,t.length)):[""]}},{key:"closeWebSocket",value:function(){this.screepsWebSock&&this.screepsWebSock.close()}}]),e}(w["e"]);S=Object(g["a"])([w["a"]],S);var _=S,V=function(t){function e(){var t;return Object(p["a"])(this,e),t=Object(h["a"])(this,Object(f["a"])(e).apply(this,arguments)),t.step=1,t.email="",t.password="",t.confirmBtnLoading=!1,t.showMessage=!1,t.messageColor="success",t.messageText="",t}return Object(b["a"])(e,t),Object(v["a"])(e,[{key:"finishBoot",value:function(){return this.storage={loginData:{email:this.email,password:this.password},commands:[]},{email:this.email,password:this.password}}},{key:"next",value:function(){2===this.step?this.login():3===this.step?this.finishBoot():this.step++}},{key:"login",value:function(){var t=this;""!==this.email&&""!==this.password&&(this.confirmBtnLoading=!0,this.message("info","正在向 Screeps 服务器验证身份..."),this.getSessionToken(this.email,this.password).then((function(e){t.step++,t.message("success","验证成功"),t.confirmBtnLoading=!1})).catch((function(e){t.confirmBtnLoading=!1,t.message("error","验证失败，请验证用户名密码是否正确")})))}},{key:"message",value:function(t,e){this.messageColor=t,this.messageText=e,this.showMessage=!0}},{key:"currentTitle",get:function(){switch(this.step){case 1:return"使用须知";case 2:return"账户确认";case 3:return"";default:return"初始化"}}}]),e}(Object(w["c"])(_,O));Object(g["a"])([Object(w["d"])()],V.prototype,"show",void 0),Object(g["a"])([Object(w["b"])("on-finish")],V.prototype,"finishBoot",null),V=Object(g["a"])([w["a"]],V);var I=V,L=I,T=(n("a0d1"),n("2877")),B=n("6544"),P=n.n(B),M=n("8336"),D=n("b0af"),N=n("99d9"),W=n("ce7e"),E=n("da13"),J=n("5d23"),$=n("a797"),A=n("2db4"),F=n("2fa4"),R=n("8654"),X=n("f665"),q=n("1e6c"),z=Object(T["a"])(L,j,C,!1,null,"cd7caf6c",null),G=z.exports;P()(z,{VBtn:M["a"],VCard:D["a"],VCardActions:N["a"],VCardText:N["b"],VCardTitle:N["c"],VDivider:W["a"],VListItem:E["a"],VListItemContent:J["a"],VListItemTitle:J["c"],VOverlay:$["a"],VSnackbar:A["a"],VSpacer:F["a"],VTextField:R["a"],VWindow:X["a"],VWindowItem:q["a"]});var U=function(t){function e(){var t;return Object(p["a"])(this,e),t=Object(h["a"])(this,Object(f["a"])(e).apply(this,arguments)),t.items=[{title:"更新身份信息",icon:"mdi-alpha-t-box"},{title:"设置 shard",icon:"mdi-alpha-t-box"},{title:"导出配置项",icon:"mdi-download-multiple"},{title:"导入配置项",icon:"mdi-upload-multiple"},{title:"关于",icon:"mdi-help-box"}],t.showSideDrawer=!1,t.showBoot=!1,t}return Object(b["a"])(e,t),Object(v["a"])(e,[{key:"onBootFinish",value:function(t){this.showBoot=!1}},{key:"mounted",value:function(){localStorage[k]||(this.showBoot=!0)}}]),e}(Object(w["c"])(O));U=Object(g["a"])([Object(w["a"])({components:{Boot:G}})],U);var H=U,K=H,Q=(n("23f9"),n("7496")),Y=n("40dc"),Z=n("5bc1"),tt=n("a75b"),et=n("132d"),nt=n("8860"),at=n("34c3"),st=n("f774"),ot=n("2a7f"),it=Object(T["a"])(K,d,m,!1,null,"02346c56",null),rt=it.exports;P()(it,{VApp:Q["a"],VAppBar:Y["a"],VAppBarNavIcon:Z["a"],VContent:tt["a"],VDivider:W["a"],VIcon:et["a"],VList:nt["a"],VListItem:E["a"],VListItemContent:J["a"],VListItemIcon:at["a"],VListItemSubtitle:J["b"],VListItemTitle:J["c"],VNavigationDrawer:st["a"],VToolbarTitle:ot["a"]});var ct=n("8c4f"),lt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"command-container"},[t._l(6,(function(e){return[n("CommandItem",{on:{send:t.sendCommand}})]}))],2)},ut=[],dt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ma-4"},[n("v-btn",{attrs:{block:"",height:"52px"},on:{click:t.exec}},[t._v("命令按钮")])],1)},mt=[],pt=function(t){function e(){return Object(p["a"])(this,e),Object(h["a"])(this,Object(f["a"])(e).apply(this,arguments))}return Object(b["a"])(e,t),Object(v["a"])(e,[{key:"exec",value:function(){return"resource"}}]),e}(a["a"]);Object(g["a"])([Object(w["b"])("send")],pt.prototype,"exec",null),pt=Object(g["a"])([w["a"]],pt);var vt=pt,ht=vt,ft=Object(T["a"])(ht,dt,mt,!1,null,"34ac1272",null),bt=ft.exports;P()(ft,{VBtn:M["a"]});var gt=function(t){function e(){return Object(p["a"])(this,e),Object(h["a"])(this,Object(f["a"])(e).apply(this,arguments))}return Object(b["a"])(e,t),Object(v["a"])(e,[{key:"sendCommand",value:function(t){return console.log(t),t}}]),e}(a["a"]);Object(g["a"])([Object(w["b"])("select")],gt.prototype,"sendCommand",null),gt=Object(g["a"])([Object(w["a"])({components:{CommandItem:bt}})],gt);var wt=gt,kt=wt,yt=Object(T["a"])(kt,lt,ut,!1,null,"04dfc1a0",null),Ot=yt.exports,jt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-list",{attrs:{flat:""}},[n("v-list-item-group",{attrs:{color:"primary"}},t._l(t.messageList,(function(t,e){return n("div",{key:e,staticClass:"item"},[n("ConsoleItem",{attrs:{content:t.content,icon:t.icon}})],1)})),0),n("div",{ref:"itemList",staticClass:"fill-block"}),n("v-text-field",{staticClass:"input-box ma-4 mr-8",attrs:{rounded:"",label:"键入命令",solo:"","hide-details":"",clearable:""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendCommand(e)}},model:{value:t.inputCommand,callback:function(e){t.inputCommand=e},expression:"inputCommand"}}),n("v-fab-transition",[n("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.inputCommand&&t.inputCommand.length>0,expression:"inputCommand && inputCommand.length > 0"}],staticClass:"fab-btn",attrs:{color:"green",dark:"",fixed:"",bottom:"",right:"",fab:""},on:{click:t.sendCommand}},[n("v-icon",[t._v("mdi-arrow-right-thick")])],1)],1),n("v-fab-transition",[n("v-btn",{directives:[{name:"show",rawName:"v-show",value:!t.inputCommand||t.inputCommand.length<=0,expression:"!inputCommand || inputCommand.length <= 0"}],staticClass:"fab-btn",attrs:{color:"pink",dark:"",fixed:"",bottom:"",right:"",fab:""},on:{click:function(e){t.showCommandList=!t.showCommandList}}},[n("v-icon",[t._v("mdi-code-braces")])],1)],1),n("v-bottom-sheet",{model:{value:t.showCommandList,callback:function(e){t.showCommandList=e},expression:"showCommandList"}},[n("Command",{on:{select:t.getCommand}})],1)],1)},Ct=[],xt=(n("a15b"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"console-item-contaienr"},[n("v-list-item",[n("v-list-item-icon",{staticClass:"my-3 mr-4"},[n("v-icon",[t._v(t._s(t.icon))])],1),n("v-list-item-content",[n("v-list-item-title",[t._v(t._s(t.content))])],1)],1),n("v-divider")],1)}),St=[],_t=function(t){function e(){return Object(p["a"])(this,e),Object(h["a"])(this,Object(f["a"])(e).apply(this,arguments))}return Object(b["a"])(e,t),e}(a["a"]);Object(g["a"])([Object(w["d"])()],_t.prototype,"content",void 0),Object(g["a"])([Object(w["d"])()],_t.prototype,"icon",void 0),_t=Object(g["a"])([w["a"]],_t);var Vt=_t,It=Vt,Lt=Object(T["a"])(It,xt,St,!1,null,"74cb05f5",null),Tt=Lt.exports;P()(Lt,{VDivider:W["a"],VIcon:et["a"],VListItem:E["a"],VListItemContent:J["a"],VListItemIcon:at["a"],VListItemTitle:J["c"]});var Bt=function(t){function e(){var t;return Object(p["a"])(this,e),t=Object(h["a"])(this,Object(f["a"])(e).apply(this,arguments)),t.messageList=[],t.showCommandList=!1,t.inputCommand="",t}return Object(b["a"])(e,t),Object(v["a"])(e,[{key:"sendCommand",value:function(){!this.inputCommand||this.inputCommand.length<=0||(console.log(this.inputCommand),this.sendConsoleExpression(this.inputCommand,"shard3"),this.messageList.push({content:this.inputCommand,icon:"mdi-arrow-top-left"}),this.inputCommand="",this.$vuetify.goTo(this.$refs.itemList,{duration:1e3}))}},{key:"getCommand",value:function(t){console.log("console",t),this.showCommandList=!1}},{key:"onMessage",value:function(t){if("a"===t.data[0])try{var e=JSON.parse(t.data.substring(1))[0],n=JSON.parse(e)[1],a=n.messages.results;if(a.length<=0)return;this.messageList.push({content:a.join("|||"),icon:"mdi-arrow-bottom-right"})}catch(s){console.log("onMessage 数据解析出错",s,t)}}},{key:"mounted",value:function(){}},{key:"destroyed",value:function(){this.closeWebSocket()}}]),e}(Object(w["c"])(_));Bt=Object(g["a"])([Object(w["a"])({components:{ConsoleItem:Tt,Command:Ot}})],Bt);var Pt=Bt,Mt=Pt,Dt=(n("18ea"),n("288c")),Nt=n("0789"),Wt=n("1baa"),Et=Object(T["a"])(Mt,jt,Ct,!1,null,"5b90a1d3",null),Jt=Et.exports;P()(Et,{VBottomSheet:Dt["a"],VBtn:M["a"],VFabTransition:Nt["b"],VIcon:et["a"],VList:nt["a"],VListItemGroup:Wt["a"],VTextField:R["a"]}),a["a"].use(ct["a"]);var $t=[{path:"/",redirect:"/console"},{path:"/command",component:Ot},{path:"/console",component:Jt}],At=new ct["a"]({routes:$t}),Ft=n("f309");a["a"].use(Ft["a"]);var Rt=new Ft["a"]({});a["a"].config.productionTip=!1,new a["a"]({router:At,vuetify:Rt,render:function(t){return t(rt)}}).$mount("#app")}});
//# sourceMappingURL=app.3858f084.js.map